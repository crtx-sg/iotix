{{- if and .Values.deviceEngine.enabled .Values.deviceEngine.deviceModels.enabled (not .Values.deviceEngine.deviceModels.configMapName) }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "iotix.fullname" . }}-device-models
  labels:
    {{- include "iotix.labels" . | nindent 4 }}
data:
  temperature-sensor.json: |
    {
      "id": "temperature-sensor-v1",
      "name": "Temperature Sensor",
      "description": "Basic temperature sensor with humidity readings",
      "version": "1.0.0",
      "type": "sensor",
      "protocol": "mqtt",
      "connection": {
        "topicPattern": "devices/${deviceId}/telemetry",
        "qos": 1,
        "keepAlive": 60
      },
      "telemetry": [
        {
          "name": "temperature",
          "type": "number",
          "unit": "celsius",
          "generator": {
            "type": "random",
            "min": 18.0,
            "max": 28.0,
            "distribution": "normal",
            "mean": 22.0,
            "stddev": 2.0
          },
          "intervalMs": 5000
        },
        {
          "name": "humidity",
          "type": "number",
          "unit": "percent",
          "generator": {
            "type": "random",
            "min": 30,
            "max": 70,
            "distribution": "uniform"
          },
          "intervalMs": 5000
        }
      ]
    }
  smart-gateway.json: |
    {
      "id": "smart-gateway-v1",
      "name": "Smart Gateway",
      "description": "Gateway device that aggregates data from child sensors",
      "version": "1.0.0",
      "type": "gateway",
      "protocol": "mqtt",
      "connection": {
        "topicPattern": "gateways/${deviceId}/telemetry",
        "qos": 2,
        "keepAlive": 30
      },
      "telemetry": [
        {
          "name": "connectedDevices",
          "type": "integer",
          "generator": {
            "type": "random",
            "min": 5,
            "max": 25,
            "distribution": "uniform"
          },
          "intervalMs": 10000
        },
        {
          "name": "cpuUsage",
          "type": "number",
          "unit": "percent",
          "generator": {
            "type": "random",
            "min": 10,
            "max": 80,
            "distribution": "normal",
            "mean": 35,
            "stddev": 15
          },
          "intervalMs": 5000
        }
      ]
    }
{{- end }}
